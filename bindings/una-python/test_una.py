import asyncio
import una

import pytest
pytest_plugins = ('pytest_asyncio',)

@pytest.fixture
def lnd_rest():
    config_lnd_rest = dict({
        "url": "https://127.0.0.1:8084",
        "macaroon": "0201036c6e6402f801030a10513fd5c864475e6b8511a719b777451e1201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e65726174651204726561640000062033e45f8e3f195ec22e39aae0ba4dfb3fa135bae4f889ad570cc173838f095186",
        "tls_certificate": "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d494943497a434341636967417749424167495241506378367078485a507a6c5a4637354642703634744177436759494b6f5a497a6a3045417749774d4445660a4d4230474131554543684d576247356b494746316447396e5a57356c636d46305a575167593256796444454e4d4173474131554541784d455a4746325a5441650a467730794d6a41344d5449784d6a55344d6a4661467730794d7a45774d4463784d6a55344d6a46614d444178487a416442674e5642416f54466d78755a4342680a645852765a3256755a584a686447566b49474e6c636e51784454414c42674e5642414d5442475268646d55775754415442676371686b6a4f50514942426767710a686b6a4f50514d4242774e434141527935326e313678324950706a792f2f5451706b484e544549722b6e7638304142676f4c51627a353865746d79594368362f0a617836734f636449346d666a614453376b5146574f69543253694e4d33306b51356130376f3448434d49472f4d41344741315564447745422f775145417749430a7044415442674e56485355454444414b4267677242674546425163444154415042674e5648524d4241663845425441444151482f4d42304741315564446751570a42425249707177536d656b424a48466b4658497243675246394d6268667a426f42674e5648524545595442666767526b59585a6c67676c7362324e68624768760a6333534342475268646d574344584276624746794c5734784c575268646d57434248567561586943436e56756158687759574e725a58534342324a315a6d4e760a626d36484248384141414748454141414141414141414141414141414141414141414748424b775441414977436759494b6f5a497a6a304541774944535141770a52674968414d39696f6f592b315051654367664d334f4c634c51685872687772363659353954727a79375a4275776750416945417a6d7372796d676d374836330a6a59675042694f38644b653767442b6732377249395136486f6337324943493d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
    })

    lnd_rest = una.Node("LndRest", config_lnd_rest)
    yield lnd_rest

@pytest.fixture
def cln_grpc():
    config_cln_grpc = dict({
        "url": "https://localhost:11005",
        "tls_certificate": "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0d0a4d494942636a434341526967417749424167494a414b34415636512f6b7142694d416f4743437147534d343942414d434d4259784644415342674e5642414d4d0d0a43324e73626942536232393049454e424d434158445463314d4445774d5441774d4441774d466f59447a51774f5459774d5441784d4441774d444177576a41570d0a4d52517745675944565151444441746a62473467556d3976644342445154425a4d424d4742797147534d34394167454743437147534d343941774548413049410d0a424e3833535075397672644c6a3862547267777338394f7874434d62454a6d4462727031556e3749367a574a7a30684c37424e632f7362617855634233714f5a0d0a2f56443572374e57376473686c36526e7149735632464f6a5454424c4d426b4741315564455151534d42434341324e73626f494a6247396a5957786f62334e300d0a4d4230474131556444675157424252696f4a492f70466341726b3232357038576449324976715337687a415042674e5648524d4241663845425441444151482f0d0a4d416f4743437147534d343942414d43413067414d4555434951444e466a58363561447a43395352644977416550743652734957554a766a67766c55692b48380d0a644a71746b4149676532682f7944574c6f696b334b586a4a7757554d4d7570435544774f6e4b3645653574424b4550344978413d0d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0d0a",
        "tls_client_certificate": "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0d0a4d4949425244434236364144416745434167674553596e76334866455254414b42676771686b6a4f50515144416a41574d52517745675944565151444441746a0d0a62473467556d39766443424451544167467730334e5441784d4445774d4441774d444261474138304d446b324d4445774d5441774d4441774d466f77476a45590d0a4d4259474131554541777750593278754947647963474d67513278705a5735304d466b77457759484b6f5a497a6a3043415159494b6f5a497a6a3044415163440d0a516741454339714979684a4b6378592f6a7755476d3633376c49425367476e374263506c67365273716c453077487a61786677594930565947536c4f596c64700d0a55496f2f4e454d6c72354d77486572362b444d2f4659732b694b4d644d427377475159445652305242424977454949445932787567676c7362324e68624768760d0a63335177436759494b6f5a497a6a304541774944534141775251496762476f496a7064364e6a5056376a533971305a4f737476712b724e5839594867716b48780d0a554d5071715238434951436a5255412b4f42647a3963634e4475434d72313178626d755863795467346f59783273326a4649474545413d3d0d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0d0a",
        "tls_client_key": "2d2d2d2d2d424547494e2050524956415445204b45592d2d2d2d2d0d0a4d494748416745414d424d4742797147534d34394167454743437147534d34394177454842473077617749424151516763556b4e4a3751756a4361584a4c346c0d0a30786c4e4b335374636e767863415a6d304e2f6d535165554146696852414e434141514c326f6a4b456b707a466a2b50425161627266755567464b41616673460d0a772b57447047797155545441664e72462f42676a5256675a4b55356956326c51696a3830517957766b7a4164367672344d7a3856697a36490d0a2d2d2d2d2d454e442050524956415445204b45592d2d2d2d2d0d0a",
    })

    cln_grpc = una.Node("ClnGrpc", config_cln_grpc)
    yield cln_grpc

@pytest.mark.asyncio
async def test_get_info(lnd_rest, cln_grpc):
    await lnd_rest.get_info()
    await cln_grpc.get_info()

@pytest.mark.asyncio
async def test_create_invoice(lnd_rest, cln_grpc):
    invoice = dict({
        "amount": 100,
        "description": "test bindings"
    })

    await lnd_rest.create_invoice(invoice)
    await cln_grpc.create_invoice(invoice)

@pytest.mark.asyncio
async def test_create_invoice_without_amount(lnd_rest, cln_grpc):
    invoice = dict({
        "description": "test bindings"
    })

    res = await lnd_rest.create_invoice(invoice)
    print(res)
    res = await cln_grpc.create_invoice(invoice)
    print(res)

invoice = dict({
    "description": "test bindings"
})

async def lnd_rest():
    config_lnd_rest = dict({
        "url": "https://127.0.0.1:8084",
        "macaroon": "0201036c6e6402f801030a10513fd5c864475e6b8511a719b777451e1201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e65726174651204726561640000062033e45f8e3f195ec22e39aae0ba4dfb3fa135bae4f889ad570cc173838f095186",
        "tls_certificate": "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d494943497a434341636967417749424167495241506378367078485a507a6c5a4637354642703634744177436759494b6f5a497a6a3045417749774d4445660a4d4230474131554543684d576247356b494746316447396e5a57356c636d46305a575167593256796444454e4d4173474131554541784d455a4746325a5441650a467730794d6a41344d5449784d6a55344d6a4661467730794d7a45774d4463784d6a55344d6a46614d444178487a416442674e5642416f54466d78755a4342680a645852765a3256755a584a686447566b49474e6c636e51784454414c42674e5642414d5442475268646d55775754415442676371686b6a4f50514942426767710a686b6a4f50514d4242774e434141527935326e313678324950706a792f2f5451706b484e544549722b6e7638304142676f4c51627a353865746d79594368362f0a617836734f636449346d666a614453376b5146574f69543253694e4d33306b51356130376f3448434d49472f4d41344741315564447745422f775145417749430a7044415442674e56485355454444414b4267677242674546425163444154415042674e5648524d4241663845425441444151482f4d42304741315564446751570a42425249707177536d656b424a48466b4658497243675246394d6268667a426f42674e5648524545595442666767526b59585a6c67676c7362324e68624768760a6333534342475268646d574344584276624746794c5734784c575268646d57434248567561586943436e56756158687759574e725a58534342324a315a6d4e760a626d36484248384141414748454141414141414141414141414141414141414141414748424b775441414977436759494b6f5a497a6a304541774944535141770a52674968414d39696f6f592b315051654367664d334f4c634c51685872687772363659353954727a79375a4275776750416945417a6d7372796d676d374836330a6a59675042694f38644b653767442b6732377249395136486f6337324943493d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
    })

    lnd_rest = una.Node("LndRest", config_lnd_rest)
    await lnd_rest.create_invoice(invoice)

async def cln_grpc():
    config_cln_grpc = dict({
        "url": "https://localhost:11005",
        "tls_certificate": "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0d0a4d494942636a434341526967417749424167494a414b34415636512f6b7142694d416f4743437147534d343942414d434d4259784644415342674e5642414d4d0d0a43324e73626942536232393049454e424d434158445463314d4445774d5441774d4441774d466f59447a51774f5459774d5441784d4441774d444177576a41570d0a4d52517745675944565151444441746a62473467556d3976644342445154425a4d424d4742797147534d34394167454743437147534d343941774548413049410d0a424e3833535075397672644c6a3862547267777338394f7874434d62454a6d4462727031556e3749367a574a7a30684c37424e632f7362617855634233714f5a0d0a2f56443572374e57376473686c36526e7149735632464f6a5454424c4d426b4741315564455151534d42434341324e73626f494a6247396a5957786f62334e300d0a4d4230474131556444675157424252696f4a492f70466341726b3232357038576449324976715337687a415042674e5648524d4241663845425441444151482f0d0a4d416f4743437147534d343942414d43413067414d4555434951444e466a58363561447a43395352644977416550743652734957554a766a67766c55692b48380d0a644a71746b4149676532682f7944574c6f696b334b586a4a7757554d4d7570435544774f6e4b3645653574424b4550344978413d0d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0d0a",
        "tls_client_certificate": "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0d0a4d4949425244434236364144416745434167674553596e76334866455254414b42676771686b6a4f50515144416a41574d52517745675944565151444441746a0d0a62473467556d39766443424451544167467730334e5441784d4445774d4441774d444261474138304d446b324d4445774d5441774d4441774d466f77476a45590d0a4d4259474131554541777750593278754947647963474d67513278705a5735304d466b77457759484b6f5a497a6a3043415159494b6f5a497a6a3044415163440d0a516741454339714979684a4b6378592f6a7755476d3633376c49425367476e374263506c67365273716c453077487a61786677594930565947536c4f596c64700d0a55496f2f4e454d6c72354d77486572362b444d2f4659732b694b4d644d427377475159445652305242424977454949445932787567676c7362324e68624768760d0a63335177436759494b6f5a497a6a304541774944534141775251496762476f496a7064364e6a5056376a533971305a4f737476712b724e5839594867716b48780d0a554d5071715238434951436a5255412b4f42647a3963634e4475434d72313178626d755863795467346f59783273326a4649474545413d3d0d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0d0a",
        "tls_client_key": "2d2d2d2d2d424547494e2050524956415445204b45592d2d2d2d2d0d0a4d494748416745414d424d4742797147534d34394167454743437147534d34394177454842473077617749424151516763556b4e4a3751756a4361584a4c346c0d0a30786c4e4b335374636e767863415a6d304e2f6d535165554146696852414e434141514c326f6a4b456b707a466a2b50425161627266755567464b41616673460d0a772b57447047797155545441664e72462f42676a5256675a4b55356956326c51696a3830517957766b7a4164367672344d7a3856697a36490d0a2d2d2d2d2d454e442050524956415445204b45592d2d2d2d2d0d0a",
    })

    cln_grpc = una.Node("ClnGrpc", config_cln_grpc)
    await cln_grpc.create_invoice(invoice)

# asyncio.run(lnd_rest())
# asyncio.run(cln_grpc())
